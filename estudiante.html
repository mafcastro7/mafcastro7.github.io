<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel del Estudiante - Buhomi</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
  />
</head>
<body>
  <main class="student-container">
    <!-- CABECERA -->
    <header class="student-header">
      <div class="student-info">
        <img src="images/avatarestudiante.png" class="student-avatar" alt="Foto del estudiante" />
        <div>
          <h2 class="student-name">Estudiante XY</h2>
          <p class="student-email">estudiantexy@gmail.com</p>
        </div>
      </div>
    </header>

    <!-- MEN√ö -->
    <nav class="student-menu">
      <button data-section="inicio" class="active">
        <i class="fa-solid fa-house"></i> Inicio
      </button>
      <button data-section="recordatorios">
        <i class="fa-solid fa-bell"></i> Recordatorios
      </button>
      <button data-section="tareas">
        <i class="fa-solid fa-book-open"></i> Mis tareas
      </button>
      <button data-section="notas">
        <i class="fa-solid fa-chart-column"></i> Notas acad√©micas
      </button>
      <button class="logout">
        <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesi√≥n
      </button>
    </nav>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="student-content">

      <!-- üè† INICIO -->
      <section id="inicio" class="section active">
        <h2>Comunicados</h2>
        <h3>Noticias y otros</h3>

        <div class="news-card">
          <div class="news-text">
            <h4>Reuni√≥n de padres</h4>
            <p>
              El pr√≥ximo 18 de noviembre se tendr√° reuni√≥n de acudientes a las 12 pm.
              Esto con el objetivo de dar las indicaciones finales del periodo en curso.
            </p>
          </div>
          <img src="images/reupadres.png" alt="Reuni√≥n de padres" class="news-image">
        </div>

        <div class="news-card">
          <div class="news-text">
            <h4>Semana de habilitaciones</h4>
            <p>
              Del 17 al 21 de noviembre. ¬°Prep√°rate para las evaluaciones finales!
            </p>
          </div>
          <img src="images/fiestas.png" alt="Semana de habilitaciones" class="news-image">
        </div>
      </section> 

      <!-- üîîRECORDATORIOS -->
      <section id="recordatorios" class="section">
        <div class="recordatorios-header">
        <h2>Recordatorios</h2>
        <img src="images/buhotelescopio.png" alt="buhito" class="recordatorios-buhito">
        </div>

        <!-- üìãLista de recordatorios -->
        <div class="recordatorios-list">
          <div class="recordatorio-item">
            <img src="images/avatarprofe.png" alt="Profesor" class="recordatorio-avatar">
            <div class="recordatorio-info">
              <h4>Quiz geometr√≠a</h4>
              <p class="fecha">10-11-2025</p>
              <p class="creador">Creado por profesor Geometr√≠a</p>
            </div>
          </div>

          <div class="recordatorio-item">
            <img src="images/avatarprofe.png" alt="Profesor" class="recordatorio-avatar">
            <div class="recordatorio-info">
              <h4>Examen recuperaci√≥n</h4>
              <p class="fecha">30-11-2025</p>
              <p class="creador">Creado por profesor Matem√°ticas</p>
            </div>
          </div>

          <div class="recordatorio-item">
            <img src="images/avatarprofe.png" alt="Profesor" class="recordatorio-avatar">
            <div class="recordatorio-info">
              <h4>Libro de lecturas</h4>
              <p class="fecha">20-12-2025</p>
              <p class="creador">Creado por profesor Lengua</p>
            </div>
          </div>
        </div>

        <!-- üìùFormulario para crear recordatorio -->
        <div class="crear-recordatorio">
          <h3>Crear recordatorio</h3>
          <form id="formRecordatorio">
            <label for="nombre">Nombre</label>
            <input type="text" id="nombre" placeholder="Nombre del recordatorio" required>

            <label for="fechaInicio">Fecha inicio</label>
            <input type="date" id="fechaInicio" required>

            <label for="fechaFin">Fecha fin</label>
            <input type="date" id="fechaFin" required>

            <button type="submit">Crear nuevo recordatorio</button>
          </form>
        </div>
      </section>

    <!-- üìò MIS TAREAS -->
    <section id="tareas" class="section">
        <header class="tasks-header">
          <h1>Mis Tareas</h1>
          <img src="images/buhosaludando2.png" alt="buhito" class="tasks-buhito">
        </header>

        <div id="calendarContainer">
          <div id="calendar" class="calendar-grid"></div>
        </div>

        <div class="daily-tasks">
          <h3 id="dayTitle">Tareas del d√≠a</h3>
          <ul id="dayTaskList"></ul>
        </div>

        <form id="taskForm" class="task-form">
          <h3>Crear nueva tarea</h3>
          <input type="text" id="taskName" placeholder="Nombre de la tarea" required>
          <input type="text" id="startDate" placeholder="Fecha inicio" readonly>
          <input type="text" id="endDate" placeholder="Fecha fin" readonly>
          <button id="createTask">Crear nueva tarea</button>
        </form>
    </section>

      <!-- üßæ NOTAS ACAD√âMICAS -->
      <section id="notas" class="section">
        <h2>Notas acad√©micas</h2>
        <table class="grades-table">
          <tr><th>Materia</th><th>Nota</th></tr>
          <tr><td>Matem√°ticas</td><td>4.5</td></tr>
          <tr><td>Ciencias</td><td>4.2</td></tr>
          <tr><td>Lengua</td><td>4.7</td></tr>
        </table>
      </section>

    </div>

    <!-- ü¶â Buhito decorativo -->
    <img src="images/buhotelescopio.png" alt="Buhito telescopio" class="buhito">
  </main>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

  <script>
    const buttons = document.querySelectorAll(".student-menu button[data-section]");
    const sections = document.querySelectorAll(".section");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        sections.forEach(sec => sec.classList.remove("active"));
        const target = btn.getAttribute("data-section");
        document.getElementById(target).classList.add("active");
        if (target === 'tareas' && typeof window.renderTasksCalendar === 'function') {
          window.renderTasksCalendar();
        }
      });
    });

    document.querySelector(".logout").addEventListener("click", () => {
      window.location.href = "index.html";
    });

    // Crear nuevo recordatorio
    const form = document.getElementById("formRecordatorio");
    const lista = document.querySelector(".recordatorios-list");

    form.addEventListener("submit", (e) => {
      e.preventDefault();

    const nombre = document.getElementById("nombre").value;
    const fechaInicio = document.getElementById("fechaInicio").value;
    const fechaFin = document.getElementById("fechaFin").value;

    const nuevo = document.createElement("div");
    nuevo.classList.add("recordatorio-item", "estudiante");
    nuevo.classList.add("recordatorio-item");
    nuevo.innerHTML = `
      <img src="images/avatarestudiante.png" alt="Estudiante" class="recordatorio-avatar">
      <div class="recordatorio-info">
        <h4>${nombre}</h4>
        <p class="fecha">${fechaInicio} - ${fechaFin}</p>
        <p class="creador">Creado por ti</p>
      </div>
    `;

    lista.appendChild(nuevo);
    form.reset();
    });


    (function(){
      const calendarEl = document.getElementById('calendar');
      const dayTitle = document.getElementById('dayTitle');
      const dayTaskList = document.getElementById('dayTaskList');
      const taskForm = document.getElementById('taskForm');
      const taskNameInput = document.getElementById('taskName');
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');

      if (typeof flatpickr !== 'undefined') {
        flatpickr(startDateInput, { dateFormat: 'Y-m-d' });
        flatpickr(endDateInput, { dateFormat: 'Y-m-d' });
      }

      let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
      let editingIndex = null; 

      function save() { localStorage.setItem('tasks', JSON.stringify(tasks)); }

      function tasksToEvents(){
        return tasks.map((t,i)=>({ id: String(i), title: t.name, start: t.start, end: t.end, className: t.done ? 'event-done' : '' }));
      }

      function showTooltip(text, targetEl){
        try{
          const tip = document.createElement('div');
          tip.className = 'small-tooltip';
          tip.textContent = text;
          document.body.appendChild(tip);
          const rect = targetEl.getBoundingClientRect();
          tip.style.left = Math.min(window.innerWidth - tip.offsetWidth - 12, rect.left + window.scrollX) + 'px';
          tip.style.top = (rect.top + window.scrollY - tip.offsetHeight - 8) + 'px';
          requestAnimationFrame(()=> tip.classList.add('show'));
          setTimeout(()=>{ tip.classList.remove('show'); setTimeout(()=> tip.remove(), 220); }, 1200);
        }catch(e){ console.warn('tooltip error', e); }
      }

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridWeek',
        locale: 'es',
        headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,dayGridWeek' },
        aspectRatio: 1.6,
        height: 'auto',
        events: tasksToEvents(),
        dateClick: function(info){
          const dateStr = info.dateStr; 
          renderDayTasks(dateStr);

          if (startDateInput) {
            if (startDateInput._flatpickr) startDateInput._flatpickr.setDate(dateStr, true, 'Y-m-d');
            else startDateInput.value = dateStr;
          }
          if (endDateInput) {
            if (endDateInput._flatpickr) endDateInput._flatpickr.setDate(dateStr, true, 'Y-m-d');
            else endDateInput.value = dateStr;
          }

          if (taskNameInput) taskNameInput.focus();
        }
      });

      calendar.render();

      window.renderTasksCalendar = function(){
        calendar.removeAllEvents();
        tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
        tasksToEvents().forEach(ev => calendar.addEvent(ev));
        calendar.render();
      };      

      function renderDayTasks(dateStr){
        dayTaskList.innerHTML = '';
        dayTitle.textContent = `Tareas del ${dateStr}`;
        const filtered = tasks.map((t,i)=>({t, i})).filter(x => (x.t.start <= dateStr && x.t.end >= dateStr) || x.t.start === dateStr);
        if(filtered.length === 0){
          dayTaskList.innerHTML = '<li>No hay tareas para este d√≠a.</li>';
          return;
        }

        filtered.forEach(x => {
          const t = x.t;
          const idx = x.i;
          const li = document.createElement('li');
          li.innerHTML = `
            <div class="task-left">
              <span class="task-name ${t.done ? 'task-done' : ''}">${t.name}</span>
              <small class="task-dates">${t.start} ‚Üí ${t.end}</small>
            </div>
            <div class="task-actions">
              <button class="toggle-done" data-index="${idx}" title="${t.done ? 'Marcar como no realizada' : 'Marcar como realizada'}">
                <i class="${t.done ? 'fa-solid fa-check-circle' : 'fa-regular fa-circle'}"></i>
              </button>
              <button class="edit-task" data-index="${idx}" title="Editar"><i class="fa-solid fa-pen"></i></button>
              <button class="delete-task" data-index="${idx}" title="Eliminar"><i class="fa-solid fa-trash"></i></button>
            </div>
          `;
          dayTaskList.appendChild(li);
        });

        dayTaskList.querySelectorAll('.delete-task').forEach(btn => {
          btn.addEventListener('click', e => {
            const idx = Number(e.currentTarget.dataset.index);
            tasks.splice(idx, 1);
            save();
            window.renderTasksCalendar();
            renderDayTasks(dateStr);
          });
        });

        dayTaskList.querySelectorAll('.edit-task').forEach(btn => {
          btn.addEventListener('click', e => {
            const idx = Number(e.currentTarget.dataset.index);
            const t = tasks[idx];
            editingIndex = idx;
            taskNameInput.value = t.name;
            if (startDateInput._flatpickr) startDateInput._flatpickr.setDate(t.start, true, 'Y-m-d'); else startDateInput.value = t.start;
            if (endDateInput._flatpickr) endDateInput._flatpickr.setDate(t.end, true, 'Y-m-d'); else endDateInput.value = t.end;
            taskNameInput.focus();
          });
        });

        dayTaskList.querySelectorAll('.toggle-done').forEach(btn => {
          btn.addEventListener('click', e => {
            const idx = Number(e.currentTarget.dataset.index);
            tasks[idx].done = !tasks[idx].done;
            save();
            window.renderTasksCalendar();
            renderDayTasks(dateStr);
            const message = tasks[idx].done ? 'Marcada como realizada' : 'Marcada como no realizada';
            showTooltip(message, e.currentTarget);
          });
        });

        dayTaskList.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      taskForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = taskNameInput.value.trim();
        const start = startDateInput.value || new Date().toISOString().split('T')[0];
        const end = endDateInput.value || start;
        if(!name) return alert('Escribe un nombre para la tarea');
        if (editingIndex === null) {
          tasks.push({ name, start, end, done: false });
          save();
          window.renderTasksCalendar();
        } else {
          const prevDone = tasks[editingIndex] && tasks[editingIndex].done;
          tasks[editingIndex] = { name, start, end, done: !!prevDone };
          save();
          window.renderTasksCalendar();
          editingIndex = null;
        }
        taskForm.reset();
        renderDayTasks(start);
        dayTaskList.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    })();
  </script>
</body>
</html>